<?php
include ("../functions.php");
include ("../f_secure.php");
include ("../config.php");
$limit = 50;
//prepare HTML text for UTF-8 character data in XML

function cleanTxt($txt) {

    return utf8_encode(

        htmlspecialchars(

            stripslashes($txt)));
}
 

// set the file's content type and character set
header("Content-Type: text/xml;charset=utf-8");

// run the query 
$sql = "SELECT review_items.item_name, 
       review_items.item_id,
	   review_items.item_desc,
	   review_items.item_type,  
       review_items.sortorder,
	   review.date_added,
	   review.source,
	   review.rating,
	   review_items.item_image
FROM review_items left join review
  on review.review_item_id = review_items.item_id
GROUP BY review_items.item_name, 
       review_items.item_id,  
       review_items.sortorder
ORDER BY item_id limit $limit"; 

    $result = mysql_query($sql) 
or die(sprintf("Couldn't execute query, %s: %s", db_errno(), db_error()));

// Get the current version of PHP
$phpversion = phpversion();

// display RSS 2.0 channel information
ECHO <<<END
<?xml version="1.0" encoding="utf-8"?>
<rss version ="2.0" xmlns:g="http://base.google.com/ns/1.0">
	<channel>
		<language>EN</language> 
		<generator>PHP/$phpversion</generator>
		
		
	<title>Review Website - $sitename</title>
	<description>$sitename is an excellent resource for user reviews.</description>
	<link>$url$directory</link>
END;

 
// loop through the array

while($row = mysql_fetch_array($result)) { 
$title = cleanTxt($row["item_name"]); 
$desc = $row["item_desc"];
$item_id = $row["item_id"]; 
$category = cleanTxt($row["category"]); 
$date_added = cleanTxt($row["date_added"]); 
$source = cleanTxt($row["source"]);
$user_image = cleanTxt($row["user_image"]); 
$item_name = cleanTxt($row["item_name"]); 
$rating = cleanTxt($row["rating"]); 
$item_type = cleanTxt($row["item_type"]); 
$item_image = cleanTxt($row["item_image"]); 
$rating = cleanTxt($row["rating"]); 


   if ($category == "") { $category = "none"; }

   //Replace certain html
   $desc_replace = array("<h3>&#160;</h3>", "<p>&#160;</p>", );
   $desc_replace_with  = array("", "", "");
   $desc = str_replace($desc_replace, $desc_replace_with, $desc);
 
   //Now clean the HTML
   $desc = strip_tags($desc);
   $desc = cleanTxt($desc);
   
   
// display each item.

ECHO <<<END

<item> 
<title>$title</title>
<g:author>$source</g:author>
<description>$desc</description>
<g:id>$item_id</g:id> 
<g:image_link>$url$directory/images/user_upload/$item_image</g:image_link>
<link>$url$directory/index2.php?item_id=$item_id</link>
<g:name_of_item_reviewed>$item_name</g:name_of_item_reviewed>
<g:publish_date>$date_added</g:publish_date>
<g:rating>$rating stars</g:rating>
<g:review_type>$item_type</g:review_type>
<g:product_type>$item_type</g:product_type> 
<g:reviewer_type>user</g:reviewer_type>
<g:url_of_item_reviewed>$url$directory/review-item/$item_id.php</g:url_of_item_reviewed>
</item>
END;
}
 
// Display end of RSS file data
ECHO <<<END
    
	</channel>
</rss>

END;
?>