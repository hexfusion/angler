[comment]
ui_page: ord/basket.html
ui_type: page
ui_name: ord/basket.html
ui_page_template: ecom_simms_left_only
ui_version: 5.6.1
ui_source: pages/ord/basket.html
ui_template: yes
ui_template_name: leftonly
[/comment]

[tmpn page_title][/tmpn]
[tmpn page_banner][/tmpn]
[tmpn display_class][/tmpn]
[tmpn members_only][/tmpn]

[control reset=1]
[control-set]
	[component]verticle_simms[/component]
[/control-set]
[control-set]
	[component]dhtml_side_menu[/component]
[/control-set]
[control-set]
	[component][/component]
[/control-set]
[control-set]
	[component][/component]
[/control-set]
[control reset=1]




@_ECOM_SIMMS_LEFT_ONLY_TOP_@
<!-- BEGIN CONTENT -->


[error auto=1 style="color: red"]

[if cgi empty_cart]
[calc]
	if($CGI->{empty_cart} > 1) {
		@$Items = ();
	}
	else {
		return q{
<script>
	if( confirm('[L]Are you sure you want to empty the cart?[/L]') ) 
		window.location='[area href=@@MV_PAGE@@ form="empty_cart=2"]';
</script>
		};
	}
	return;
[/calc]
[/if]


<br><b>[L]Your Current Shopping Cart[/L]:</b><br />
<br />
<font color="#990000">Free shipping orders over $100* </font>
<br>
[if type=data term="discountcodes::discount_code::[evalue coupon]"]

[discount code=ALL_ITEMS] $s * .90 [/discount]
<br><b>[L]<font color="#CC0000">Congratulations You Just Caught a Great Deal: 10% OFF</font>[/L]</b><br>
[else][discount code=ALL_ITEMS][/discount][/else]
[/if]

<table width="100%" cellspacing="0" border="0">
<tr>
	<td align="center">

	[calc]
		my $cname = $Config->{CookieName} || 'MV_SESSION_ID';
		$Scratch->{have_cookie} = $Tag->read_cookie($cname)
			and delete $Scratch->{tried};
		return;
	[/calc]
	[if scratch have_cookie]
	[elsif scratch tried]
    		[L CART_MSG1]You must have cookies set to leave the basket. Check out now or forever lose your shopping cart.[/L]
	[/elsif]
	[else]
		[set tried]1[/set]
		[bounce href="[area ord/basket]"]
	[/else]
	[/if]

	<FORM ACTION="[process secure=1]" METHOD=POST name="basket">
        [form-session-id]
    	<INPUT TYPE=hidden NAME=mv_doit      VALUE=refresh>
    	<INPUT TYPE=hidden NAME=mv_orderpage VALUE="ord/basket">
    	<INPUT TYPE=hidden NAME=mv_nextpage  VALUE=index>
<input type=hidden name=mv_order_profile value=credit_card>
    	<br>

	<table>
    	<tr>
      		<td>
        	<table cellspacing="0" cellpadding="4" border="0" style="border-collapse: collapse">
				<tr style="border: 1px solid black;">
          			<td class="titletab_small"><b>&nbsp;[L]Remove[/L]</b></td>
			        <td class="titletab_small" align="center"><b>[L]SKU[/L]</b></td>
          			<td class="titletab_small"><b>[L]Description[/L]</b></td>
          			<td class="titletab_small"><b>[L]Quantity[/L]</b></td>
          			<td class="titletab_small" align="center"><b>[L]Price[/L]</b></td>
          			<td class="titletab_small"><b>[L]Total[/L]&nbsp;</b></td>
				</tr>
			<tbody>
	
[if items]
[then]
[item-list]

[item-change 2][condition]2[/condition]
[/item-change 2]

[item-calc]
#Log("Checking master item $master");
	$row_class = ++$count % 2 ?  'cartnorm' : 'cartalt';
	my $item = '[item-increment]';
	my $up = q{[item-data merchandising upsell_to]};
	my $cr = q{[item-data merchandising cross_sell]};
	$upsell_remove{'[item-code]'} = 1;
	$cross_remove{'[item-code]'} = 1;
	my %seen = ( '' => 1 );

	$Scratch->{upsell} .= " $up" if $up;
	$Scratch->{cross_codes} .= " $cr" if $cr;
	my @up = split /\s+/, $Scratch->{upsell};
	my @cr = split /\s+/, $Scratch->{cross_codes};
	@up = grep  ( (!$seen{$_}++ && ! $upsell_remove{$_}), @up);
	@cr = grep  ( (!$seen{$_}++ && ! $cross_remove{$_}), @cr);
	$Scratch->{upsell} = join " ", @up;
	$Scratch->{cross_codes} = join " ", @cr;
	return;
[/item-calc]

	<TR class="[item-calc]$row_class || 'cartnorm'[/item-calc]">
		<TD align=center valign="top">
[if-item-param !mv_si]
	    		<INPUT TYPE=checkbox NAME="[item-quantity-name]" onClick="this.form.action='[process]', this.form.submit()" VALUE=0>
[/if-item-param]
	  	</TD>
	  	<TD valign="top"><b>[item-sku]</b></TD>
	  	<td><a href="[area href="[item-sku]"]" class="cartlink"><b>[item-description]</b></A><br><br>

	[if scratch dealer]
	[if-item-data pricing sku]
	    <BR>[page quantity [item-code]]
	    [L]QUANTITY PRICING[/L]</A>
	[/if-item-data]
	[/if]
	[if-item-field weight]
	[seti weight][summary amount=`[item-quantity] * [item-field weight]`][/seti]
	[/if-item-field]
	[if-item-param mv_min_under]
		<br>
		<span style="color: __CONTRAST__; font-size: 8pt">
		[msg arg.0="[item-param mv_min_quantity]"]Minimum order quantity of %s enforced.[/msg]
		</span>
	[/if-item-param]
	[if-item-param mv_max_over]
		<br>
		<span style="color: __CONTRAST__; font-size: 8pt">
		[msg arg.0="[item-param mv_max_quantity]"]Maximum order quantity of %s enforced.[/msg]
		</span>
	[/if-item-param]

[if-item-data merchandising others_bought]
  [if compare="__CART_OTHERS_BOUGHT__"]
	[perl tables=products]
		my $hash = [item-data merchandising others_bought];
		my @ary = sort { $hash->{$b} <=> $hash->{$a} } keys %$hash;
		return '' unless @ary;
		my %in_basket;
		splice(@ary, 3);
		for(@{$Carts->{main}}) {
			$in_basket{$_->{code}} = 1;
		}
		@ary = grep ! $in_basket{$_}, @ary;
		return '' unless @ary;
		my $out = <<'EOF';
	    <TABLE>
	    <TR>
              <TD class="titletab_small">[L]&nbsp;Customers who bought this item also bought&nbsp;[/L]:</TD>
	    </TR>
            <TR class="[item-calc]$row_class || 'contentbar1'[/item-calc]">
	      <TD>
EOF
		for(@ary) {
 			my $desc = tag_data( 'products', 'description', $_);
			$out .= <<EOF;
		<A HREF="[area $_]" class="cartlink">$desc</A><BR>
EOF
		}
		return $out . '</TD></TR></TABLE>';
	[/perl]
  [/if]
[/if-item-data]


[if compare="__CART_UPSELL__"]
	[set upsell_found][/set]
	[loop list="[item-data merchandising upsell_to]"]
	[if scratch upsell_found]
	<TABLE>
	<TR>
		<TD class="titletab_small">
			[L]&nbsp;Other items you may like&nbsp;[/L]:
	      	</TD>
	      	<TD></TD>
	</TR>
	<TR>
	      	<TD>
		  [list]
		  [loop-calc]
		  @ary = grep $_->{code} eq q{[loop-code]}, @{$Carts->{main}};
		  return if scalar @ary;
		  $Scratch->{upsell_found} = 1;
		  return q{<A HREF="[area [loop-code]]" class="cartlink">[loop-description]</A><BR>};
		  [/loop-calc]
		  [/list]
	      	</TD>
	</TR>
	</table>

	[/if]
	[/loop]
[/if]

	<br></TD>

[input-filter name="[item-quantity-name]" op="nullselect digits_dot"][/input-filter]

	  <TD ALIGN=CENTER valign="top">
	    <INPUT TYPE=text NAME="[item-quantity-name]" VALUE="[item-quantity]" SIZE=3>
	  </TD>
	[if discount [item-code]]
	  <TD ALIGN=right valign="top">
	    [L]Regular price[/L] <STRIKE>[item-price]</STRIKE>
	    <BR>
	    <B>[L]Your price[/L]: $0.00<br>
	    [L]You save[/L]: [item-difference]
	  </TD>
	  <TD ALIGN=right valign="top">
	    <strike>[item-subtotal]</strike><br>
	    <B>[item-discount-subtotal]<BR>
	    [L]You save[/L]: [item-discount]</b>
	  </TD>
	[else]
	  <TD ALIGN=right valign="top">[item-price]</TD>
	  <TD ALIGN=right valign="top">[item-subtotal]</TD>
	[/else]
	[/if]
	</TR>


[/item-list]
[/then]
[else]

	<TR>
	  <TD ALIGN=CENTER COLSPAN=8 class="cartnorm">
	    <b>[L]No items at the moment.[/L]</b>
	  </TD>
	</TR>

[/else]
[/if]

	<TR>
	  <TD ALIGN=CENTER COLSPAN=8 class="cartnorm"><img src="/assetstore/site/images/dashed_hr.gif" width="500" height="2" alt="dash" /></TD>
	</TR>
        
        </table>
       <table width="80%">
         		<tr>
          <td align="right" class="contentbar1"> [L]<strong>Country*</strong>[/L] </td>
		  <td colspan="4" class="contentbar1"> [display name=country type=country_select value="[evalue country]" extra='onchange="this.form.submit()"'] </td>
	    </tr>
        </table> 

      </td>
    </tr>
    </table>

 


    <table border="0" width="60%">  
    <tr>
      <td>

	<table border="0" width="100%">
        <tr> 
          <td width="63%" valign="top"><table width="100%" border="0">
            <tr>
              <td width="50%"><a href="http://www.westbranchangler.com/"><img src="/assetstore/site/images/btn_continue_shopping_westbranch.gif" alt="continue shopping" width="140" height="28" border="0" /></a></td>
              <td width="50%" align="right">
              		[if type=evalue term=country op="eq" compare="US"]
                    [button
              src='/assetstore/site/images/btn_checkout_westbranch.gif'
			  text="check out with West Branch"
              hidetext=1
	  	      class=button3
			  form=basket
		  ]
			mv_order_profile=credit_card
			mv_todo=return
			mv_nextpage=__CHECKOUT_PAGE__
		[/button]
        [/if]
              </td>
            </tr>
            <tr>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
            </tr>
           </table></td>
          <td width="37%" align="Right">
            <table cellspacing="0" cellpadding="4" border="0">
              <tr> 
                <td align=right>
                  [L]Shipping Weight[/L]:
                  </td>
                <td class="titletab_small" align="right">[summary format="%s" total=1]</td>
                </tr>
              <tr>
                <td align="right">
                  <b>[L]Subtotal[/L]:</b>
                  </td>
                <td class="titletab_small" align=right><b>[subtotal]</b></td>
                </tr>
               <tr>
                <td colspan="2" align="right">  <INPUT type="submit" value="[L]Recalculate[/L]" class="button3"></td>
                </tr>
              </table>
          </td>
        </tr>

        </table>

      </td>
    </tr>
	</form>
	
	  <form action="[process secure=1]" method="POST" name="paypal">
    [form-session-id]
    <input type=hidden NAME=mv_doit       value=refresh>
    <input type=hidden NAME=mv_nextpage   value="ord/basket">
    <input type=hidden name=mv_check      value="Save_database">
	<input type=hidden name=mv_successpage value="ord/paypalsetrequest">
    <input type=hidden name=mv_session_id value="[data session id]">

<tr>
              <td colspan="2" style="padding-left: 30%;">
              [button
          name="mv_click"
          src='/assetstore/site/images/pp_xpressCheckout.gif'
          text="Paypal"
          hidetext=1
    	  form=paypal
		  ]
          [run-profile name=paypalexpress]
          [if type=explicit compare="[error all=1 show_var=1 keep=1]"]
          mv_nextpage=ord/checkout
          [else]
          [charge route="paypalexpress" pprequest="setrequest"]
          [/else]
          [/if]
          mv_todo=return
      [/button]

              </td>
              </tr>
 </form>

    </TABLE>

	</table>



<!-- END CONTENT -->
@_ECOM_SIMMS_LEFT_ONLY_BOTTOM_@
